# 股票市值数据管理

## 概述
本项目包含一个市值数据管理程序，用于获取和存储A股市场所有股票的市值数据，以便选股程序使用。

## 文件说明

### 1. get_market_caps.py
市值数据获取和管理程序，主要功能包括：
- 获取A股市场所有股票的实时市值数据
- 根据历史股价比例估算历史市值
- 从本地历史数据获取历史股价（无需调用接口）
- 将市值数据存储到本地文件
- 提供历史市值查询接口

### 2. 市值数据文件
- `full_stock_data/market_caps.json`: 存储所有股票的当前市值数据
- `full_stock_data/daily_data/`: 存储所有股票的日线历史数据（CSV格式）

## 使用方法

### 1. 更新市值数据
```bash
python get_market_caps.py update
```
此命令会获取最新的A股市场市值数据并保存到本地。

### 2. 查询历史市值
```bash
python get_market_caps.py get <股票代码> <日期>
```
例如：
```bash
python get_market_caps.py get 000001 2026-01-12
```

### 3. 在选股程序中使用
选股程序（如 [select_2026_01_12.py](file:///Users/ztm/gopath/src/test1/quantv2/select_2026_01_12.py)）会自动使用本地市值数据，优先使用市值管理器获取历史市值。

## 工作原理

1. **数据获取**：通过 `akshare` 获取A股实时行情数据，包括股价和市值
2. **历史数据**：从本地 `full_stock_data/daily_data/` 目录获取历史股价数据
3. **历史估算**：通过目标日期的股价与当前股价的比例，估算目标日期的市值
4. **本地存储**：将市值数据保存到 `full_stock_data/market_caps.json`
5. **数据使用**：选股程序从本地加载市值数据，无需网络请求获取历史数据

## 注意事项

1. 市值估算基于股价比例，如果期间有股本变动（如增发、回购等），估算会有偏差
2. 需要定期更新市值数据以保持准确性
3. 依赖本地历史数据文件（daily_data目录），确保数据完整性
4. 历史股价数据的可用性会影响市值估算的准确性

## 依赖库
- `akshare`
- `pandas`
- `numpy`

## 性能优化
- 选股程序使用缓存机制避免重复计算
- 市值数据本地存储，减少网络请求
- 历史股价从本地文件读取，无需接口调用
- 数据批量处理，提高效率